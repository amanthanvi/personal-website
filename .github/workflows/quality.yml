name: Content Quality

on:
  pull_request:
  push:
    branches: ["main"]

jobs:
  lint-markdown:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v5
      - name: Check for markdown files
        id: check_files
        run: |
          if compgen -G "*.md" > /dev/null; then
            echo "has_files=true" >> $GITHUB_OUTPUT
          else
            echo "has_files=false" >> $GITHUB_OUTPUT
          fi
      - uses: DavidAnson/markdownlint-cli2-action@v20
        if: steps.check_files.outputs.has_files == 'true'
        with:
          globs: |
            README.md
        continue-on-error: true

  lint-yaml:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v5
      - uses: ibiqlik/action-yamllint@v3
        with:
          file_or_dir: .github/workflows/
        continue-on-error: true

  spellcheck:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v5
      - uses: codespell-project/actions-codespell@v2
        with:
          check_filenames: true
          ignore_words_list: adn,aman,thanvi,doj,ustp,cisa,nasa,umd,sdls,cfs,nos3,ccds,ngn,scan,ltsc,eoust,govt,config
          skip: ./.git,./node_modules
        continue-on-error: true

  link-check:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v5
      - name: Lychee link check
        uses: lycheeverse/lychee-action@v2
        with:
          args: --no-progress --max-concurrency 5 --verbose './*.html'
          fail: false
        env:
          GITHUB_TOKEN: ${{secrets.GITHUB_TOKEN}}
        continue-on-error: true
