name: Content Quality

on:
  pull_request:
  push:
    branches: [ "main", "master" ]

jobs:
  lint-markdown:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: DavidAnson/markdownlint-cli2-action@v17
        with:
          globs: 'content/**/*.md'
          
  lint-yaml:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: ibiqlik/action-yamllint@v3
        with:
          file_or_dir: .github/workflows/
          
  spellcheck:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: codespell-project/actions-codespell@v2
        with:
          check_filenames: true
          ignore_words_list: adn,aman,thanvi
          skip: ./themes,./public,./resources,./static/fonts,./.git,./node_modules
          
  link-check:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Setup Hugo
        uses: actions/setup-hugo@v3
        with:
          hugo-version: '0.148.2'
          extended: true
      - name: Build site
        run: hugo --minify
      - name: Lychee link check
        uses: lycheeverse/lychee-action@v1
        with:
          args: --no-progress --max-concurrency 5 --verbose './public/**/*.html'
          fail: false
        env:
          GITHUB_TOKEN: ${{secrets.GITHUB_TOKEN}}